import { FieldMetadataInterface } from 'src/engine/metadata-modules/field-metadata/interfaces/field-metadata.interface';

import {
  fieldNumberMock,
  objectMetadataItemMock,
} from 'src/engine/api/__mocks__/object-metadata-item.mock';
import { checkFields } from 'src/engine/api/rest/core/query-builder/utils/check-fields.utils';
import { FieldMetadataMap } from 'src/engine/metadata-modules/types/field-metadata-map';
import { ObjectMetadataItemWithFieldMaps } from 'src/engine/metadata-modules/types/object-metadata-item-with-field-maps';

describe('checkFields', () => {
  // TODO put somewhere
  const OPPORTUNITY_MOCK: ObjectMetadataItemWithFieldMaps = {
    id: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
    standardId: '20202020-9549-49dd-b2b2-883999db8938',
    dataSourceId: '861b8e41-e1ff-415d-9d5a-1b7ca1af104f',
    nameSingular: 'opportunity',
    namePlural: 'opportunities',
    labelSingular: 'Opportunity',
    labelPlural: 'Opportunities',
    description: 'An opportunity',
    icon: 'IconTargetArrow',
    standardOverrides: null,
    targetTableName: 'DEPRECATED',
    isCustom: false,
    isRemote: false,
    isActive: true,
    isSystem: false,
    isAuditLogged: true,
    isSearchable: true,
    shortcut: 'O',
    labelIdentifierFieldMetadataId: '60ae4e32-c2f1-4435-adca-22931f8b41b6',
    imageIdentifierFieldMetadataId: null,
    isLabelSyncedWithName: false,
    workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
    createdAt: '2025-06-27T12:55:13.271Z',
    updatedAt: '2025-06-27T12:55:13.271Z',
    indexMetadatas: [
      {
        id: '2dc9fbff-2223-4fac-a5d6-0907427e81a2',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
        name: 'IDX_4f469d3a7ee08aefdc099836364',
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        isCustom: false,
        isUnique: false,
        indexWhereClause: null,
        indexType: 'BTREE',
        indexFieldMetadatas: [
          {
            id: '3e05915b-2e7d-4fbc-90eb-e97e18415dc7',
            indexMetadataId: '2dc9fbff-2223-4fac-a5d6-0907427e81a2',
            fieldMetadataId: '542b3c00-9b94-454a-94ca-8afb09c68faf',
            order: 0,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
          {
            id: 'a9cd6b3c-3e90-499c-ae49-e0585ac20f54',
            indexMetadataId: '2dc9fbff-2223-4fac-a5d6-0907427e81a2',
            fieldMetadataId: 'd38a6dec-1694-4f8b-8760-61a5ff330022',
            order: 1,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
        ],
      },
      {
        id: 'fe838732-b08a-4af3-8755-9a73e300500b',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
        name: 'IDX_82cdf247553f960093baa7c6635',
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        isCustom: false,
        isUnique: false,
        indexWhereClause: null,
        indexType: 'BTREE',
        indexFieldMetadatas: [
          {
            id: '9ba132e3-dffb-411a-b15f-bd24d289837a',
            indexMetadataId: 'fe838732-b08a-4af3-8755-9a73e300500b',
            fieldMetadataId: 'f6672ee2-4f52-4dea-a116-723f9bf7f082',
            order: 0,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
          {
            id: '442f3159-c818-48d7-a006-6c91e2b5b564',
            indexMetadataId: 'fe838732-b08a-4af3-8755-9a73e300500b',
            fieldMetadataId: 'd38a6dec-1694-4f8b-8760-61a5ff330022',
            order: 1,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
        ],
      },
      {
        id: '41ed042c-37f6-497a-b0b9-1a7831e15c0c',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
        name: 'IDX_425ac6c73ecb993cf9cbc2c2b00',
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        isCustom: false,
        isUnique: false,
        indexWhereClause: null,
        indexType: 'BTREE',
        indexFieldMetadatas: [
          {
            id: 'e32cc64d-c036-4bb4-b14c-940733b93ac6',
            indexMetadataId: '41ed042c-37f6-497a-b0b9-1a7831e15c0c',
            fieldMetadataId: '467fc358-fc02-4be2-be1a-e121daf5400d',
            order: 0,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
          {
            id: '03f14405-8c59-4769-a0b6-f530d17edabd',
            indexMetadataId: '41ed042c-37f6-497a-b0b9-1a7831e15c0c',
            fieldMetadataId: 'd38a6dec-1694-4f8b-8760-61a5ff330022',
            order: 1,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
        ],
      },
      {
        id: '68f34fea-45d7-456f-98bc-b804d2519e65',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
        name: 'IDX_9f96d65260c4676faac27cb6bf3',
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        isCustom: false,
        isUnique: false,
        indexWhereClause: null,
        indexType: 'GIN',
        indexFieldMetadatas: [
          {
            id: '229f4075-4bb2-462e-9fb5-252f66c42ca3',
            indexMetadataId: '68f34fea-45d7-456f-98bc-b804d2519e65',
            fieldMetadataId: 'a81c87f6-5e10-4780-babb-38a465ac546c',
            order: 0,
            createdAt: '2025-06-27T12:55:13.271Z',
            updatedAt: '2025-06-27T12:55:13.271Z',
          },
        ],
      },
    ],
    fieldsById: {
      '60ae4e32-c2f1-4435-adca-22931f8b41b6': {
        id: '60ae4e32-c2f1-4435-adca-22931f8b41b6',
        standardId: '20202020-8609-4f65-a2d9-44009eb422b5',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'TEXT',
        name: 'name',
        label: 'Name',
        defaultValue: "''",
        description: 'The opportunity name',
        icon: 'IconTargetArrow',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      'eed5ffe1-5eef-417a-b517-ebeedaa8e10b': {
        id: 'eed5ffe1-5eef-417a-b517-ebeedaa8e10b',
        standardId: '20202020-583e-4642-8533-db761d5fa82f',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'CURRENCY',
        name: 'amount',
        label: 'Amount',
        defaultValue: { amountMicros: null, currencyCode: "''" },
        description: 'Opportunity amount',
        icon: 'IconCurrencyDollar',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '93f291c5-597c-44d3-98ec-ea71aea5256b': {
        id: '93f291c5-597c-44d3-98ec-ea71aea5256b',
        standardId: '20202020-527e-44d6-b1ac-c4158d307b97',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'DATE_TIME',
        name: 'closeDate',
        label: 'Close date',
        defaultValue: null,
        description: 'Opportunity close date',
        icon: 'IconCalendarEvent',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '542b3c00-9b94-454a-94ca-8afb09c68faf': {
        id: '542b3c00-9b94-454a-94ca-8afb09c68faf',
        standardId: '20202020-6f76-477d-8551-28cd65b2b4b9',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'SELECT',
        name: 'stage',
        label: 'Stage',
        defaultValue: "'NEW'",
        description: 'Opportunity stage',
        icon: 'IconProgressCheck',
        standardOverrides: null,
        options: [
          {
            id: '0e0e931a-dba8-4975-81bd-b29a41c0a387',
            color: 'red',
            label: 'New',
            value: 'NEW',
            position: 0,
          },
          {
            id: '8944b6bd-1c9d-490c-940c-bf47addcd6a1',
            color: 'purple',
            label: 'Screening',
            value: 'SCREENING',
            position: 1,
          },
          {
            id: '412ae33f-1368-438b-8702-6d5e5727a888',
            color: 'sky',
            label: 'Meeting',
            value: 'MEETING',
            position: 2,
          },
          {
            id: 'f3ea52a3-41e4-4b4e-a038-f02645f55767',
            color: 'turquoise',
            label: 'Proposal',
            value: 'PROPOSAL',
            position: 3,
          },
          {
            id: '86f45bfa-8acf-4934-8519-42f7c9133cd5',
            color: 'yellow',
            label: 'Customer',
            value: 'CUSTOMER',
            position: 4,
          },
        ],
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      'bd50d3c3-30a5-4d8e-9b93-12d31ece0aaa': {
        id: 'bd50d3c3-30a5-4d8e-9b93-12d31ece0aaa',
        standardId: '20202020-806d-493a-bbc6-6313e62958e2',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'POSITION',
        name: 'position',
        label: 'Position',
        defaultValue: 0,
        description: 'Opportunity record position',
        icon: 'IconHierarchy2',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: true,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '860dc096-f95f-424f-ab32-65961e8e9635': {
        id: '860dc096-f95f-424f-ab32-65961e8e9635',
        standardId: '20202020-a63e-4a62-8e63-42a51828f831',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'ACTOR',
        name: 'createdBy',
        label: 'Created by',
        defaultValue: { name: "'System'", source: "'MANUAL'", context: {} },
        description: 'The creator of the record',
        icon: 'IconCreativeCommonsSa',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      'a81c87f6-5e10-4780-babb-38a465ac546c': {
        id: 'a81c87f6-5e10-4780-babb-38a465ac546c',
        standardId: '428a0da5-4b2e-4ce3-b695-89a8b384e6e3',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'TS_VECTOR',
        name: 'searchVector',
        label: 'Search vector',
        defaultValue: null,
        description: 'Field used for full-text search',
        icon: 'IconUser',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: true,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '4d5382b0-8f4a-4f8d-822e-90fe72f75b79': {
        id: '4d5382b0-8f4a-4f8d-822e-90fe72f75b79',
        standardId: '20202020-eda0-4cee-9577-3eb357e3c22b',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'UUID',
        name: 'id',
        label: 'Id',
        defaultValue: 'uuid',
        description: 'Id',
        icon: 'Icon123',
        standardOverrides: null,
        options: null,
        settings: null,
        isCustom: false,
        isActive: true,
        isSystem: true,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      'fed5a74d-f120-4b59-b239-f7f1d8eb243e': {
        id: 'fed5a74d-f120-4b59-b239-f7f1d8eb243e',
        standardId: '20202020-66ac-4502-9975-e4d959c50311',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'DATE_TIME',
        name: 'createdAt',
        label: 'Creation date',
        defaultValue: 'now',
        description: 'Creation date',
        icon: 'IconCalendar',
        standardOverrides: null,
        options: null,
        settings: { displayFormat: 'RELATIVE' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: false,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '126d6d78-dcc8-4318-9756-b87377692561': {
        id: '126d6d78-dcc8-4318-9756-b87377692561',
        standardId: '20202020-d767-4622-bdcf-d8a084834d86',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'DATE_TIME',
        name: 'updatedAt',
        label: 'Last update',
        defaultValue: 'now',
        description: 'Last time the record was changed',
        icon: 'IconCalendarClock',
        standardOverrides: null,
        options: null,
        settings: { displayFormat: 'RELATIVE' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: false,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: false,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      'd38a6dec-1694-4f8b-8760-61a5ff330022': {
        id: 'd38a6dec-1694-4f8b-8760-61a5ff330022',
        standardId: '20202020-b9a7-48d8-8387-b9a3090a50ec',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'DATE_TIME',
        name: 'deletedAt',
        label: 'Deleted at',
        defaultValue: null,
        description: 'Date when the record was deleted',
        icon: 'IconCalendarMinus',
        standardOverrides: null,
        options: null,
        settings: { displayFormat: 'RELATIVE' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: null,
        relationTargetObjectMetadataId: null,
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      'f6672ee2-4f52-4dea-a116-723f9bf7f082': {
        id: 'f6672ee2-4f52-4dea-a116-723f9bf7f082',
        standardId: '20202020-8dfb-42fc-92b6-01afb759ed16',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'pointOfContact',
        label: 'Point of Contact',
        defaultValue: null,
        description: 'Opportunity point of contact',
        icon: 'IconUser',
        standardOverrides: null,
        options: null,
        settings: {
          onDelete: 'SET_NULL',
          relationType: 'MANY_TO_ONE',
          joinColumnName: 'pointOfContactId',
        },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: '03d47b5f-a36b-4889-97d4-63a578423688',
        relationTargetObjectMetadataId: '62c2ce6b-6799-4a38-92d3-8e844a7ea8ab',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '467fc358-fc02-4be2-be1a-e121daf5400d': {
        id: '467fc358-fc02-4be2-be1a-e121daf5400d',
        standardId: '20202020-cbac-457e-b565-adece5fc815f',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'company',
        label: 'Company',
        defaultValue: null,
        description: 'Opportunity company',
        icon: 'IconBuildingSkyscraper',
        standardOverrides: null,
        options: null,
        settings: {
          onDelete: 'SET_NULL',
          relationType: 'MANY_TO_ONE',
          joinColumnName: 'companyId',
        },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: 'f790c82e-bd16-4f63-8165-0a7f5d78170d',
        relationTargetObjectMetadataId: '513aea09-0be8-4764-8e0d-7a2e1c66f78c',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '06e8efca-fd9f-48f0-bd5f-5b0fec6a5de4': {
        id: '06e8efca-fd9f-48f0-bd5f-5b0fec6a5de4',
        standardId: '20202020-a1c2-4500-aaae-83ba8a0e827a',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'favorites',
        label: 'Favorites',
        defaultValue: null,
        description: 'Favorites linked to the opportunity',
        icon: 'IconHeart',
        standardOverrides: null,
        options: null,
        settings: { relationType: 'ONE_TO_MANY' },
        isCustom: false,
        isActive: true,
        isSystem: true,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: 'fb7c6533-7c3c-4149-b400-5a958910c7a2',
        relationTargetObjectMetadataId: 'b8d22c13-df10-42dc-baed-ea77db7ad96c',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '3a25add4-88ab-4138-98ce-80533bb423e3': {
        id: '3a25add4-88ab-4138-98ce-80533bb423e3',
        standardId: '20202020-59c0-4179-a208-4a255f04a5be',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'taskTargets',
        label: 'Tasks',
        defaultValue: null,
        description: 'Tasks tied to the opportunity',
        icon: 'IconCheckbox',
        standardOverrides: null,
        options: null,
        settings: { relationType: 'ONE_TO_MANY' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: false,
        relationTargetFieldMetadataId: 'd8797dbb-eb77-4b1c-b6a6-d5dcd13b1634',
        relationTargetObjectMetadataId: '477afff9-3af1-4c4f-90f4-cd43c53f7f41',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '6f0ea6bd-4258-422b-b35b-db3f090af8da': {
        id: '6f0ea6bd-4258-422b-b35b-db3f090af8da',
        standardId: '20202020-dd3f-42d5-a382-db58aabf43d3',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'noteTargets',
        label: 'Notes',
        defaultValue: null,
        description: 'Notes tied to the opportunity',
        icon: 'IconNotes',
        standardOverrides: null,
        options: null,
        settings: { relationType: 'ONE_TO_MANY' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: false,
        relationTargetFieldMetadataId: 'baa8480e-d927-4c91-9893-28cea5aff979',
        relationTargetObjectMetadataId: '48c2de8a-8a5e-4dea-868b-71611e718a73',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '292b289d-16ca-40a7-a1ba-712975c916cd': {
        id: '292b289d-16ca-40a7-a1ba-712975c916cd',
        standardId: '20202020-87c7-4118-83d6-2f4031005209',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'attachments',
        label: 'Attachments',
        defaultValue: null,
        description: 'Attachments linked to the opportunity',
        icon: 'IconFileImport',
        standardOverrides: null,
        options: null,
        settings: { relationType: 'ONE_TO_MANY' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: '17154f22-9236-427a-8a8a-a2296b93b542',
        relationTargetObjectMetadataId: '1b778c29-3005-4c93-a04c-2941f7424f54',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
      '743966eb-92a5-47bf-a38d-c1c72b2c3e4d': {
        id: '743966eb-92a5-47bf-a38d-c1c72b2c3e4d',
        standardId: '20202020-30e2-421f-96c7-19c69d1cf631',
        objectMetadataId: 'b28fec06-6e2c-42f6-a83c-cc58d776af88',
        type: 'RELATION',
        name: 'timelineActivities',
        label: 'Timeline Activities',
        defaultValue: null,
        description: 'Timeline Activities linked to the opportunity.',
        icon: 'IconTimelineEvent',
        standardOverrides: null,
        options: null,
        settings: { relationType: 'ONE_TO_MANY' },
        isCustom: false,
        isActive: true,
        isSystem: false,
        isNullable: true,
        isUnique: false,
        workspaceId: '20202020-1c25-4d02-bf25-6aeccf7ea419',
        isLabelSyncedWithName: true,
        relationTargetFieldMetadataId: 'fb517a84-2d54-41c7-b886-29deca3c28d5',
        relationTargetObjectMetadataId: '8213a1e3-a89e-4e4d-b3d9-c3f99e7c7483',
        createdAt: '2025-06-27T12:55:13.271Z',
        updatedAt: '2025-06-27T12:55:13.271Z',
      },
    },
    fieldIdByName: {
      name: '60ae4e32-c2f1-4435-adca-22931f8b41b6',
      amount: 'eed5ffe1-5eef-417a-b517-ebeedaa8e10b',
      closeDate: '93f291c5-597c-44d3-98ec-ea71aea5256b',
      stage: '542b3c00-9b94-454a-94ca-8afb09c68faf',
      position: 'bd50d3c3-30a5-4d8e-9b93-12d31ece0aaa',
      createdBy: '860dc096-f95f-424f-ab32-65961e8e9635',
      searchVector: 'a81c87f6-5e10-4780-babb-38a465ac546c',
      id: '4d5382b0-8f4a-4f8d-822e-90fe72f75b79',
      createdAt: 'fed5a74d-f120-4b59-b239-f7f1d8eb243e',
      updatedAt: '126d6d78-dcc8-4318-9756-b87377692561',
      deletedAt: 'd38a6dec-1694-4f8b-8760-61a5ff330022',
      pointOfContact: 'f6672ee2-4f52-4dea-a116-723f9bf7f082',
      company: '467fc358-fc02-4be2-be1a-e121daf5400d',
      favorites: '06e8efca-fd9f-48f0-bd5f-5b0fec6a5de4',
      taskTargets: '3a25add4-88ab-4138-98ce-80533bb423e3',
      noteTargets: '6f0ea6bd-4258-422b-b35b-db3f090af8da',
      attachments: '292b289d-16ca-40a7-a1ba-712975c916cd',
      timelineActivities: '743966eb-92a5-47bf-a38d-c1c72b2c3e4d',
    },
    fieldIdByJoinColumnName: {
      pointOfContactId: 'f6672ee2-4f52-4dea-a116-723f9bf7f082',
      companyId: '467fc358-fc02-4be2-be1a-e121daf5400d',
    },
    // TODO prastoin
  } as any;
  const completeFieldNumberMock: FieldMetadataInterface = {
    id: 'field-number-id',
    type: fieldNumberMock.type,
    name: fieldNumberMock.name,
    label: 'Field Number',
    objectMetadataId: 'object-metadata-id',
    isNullable: fieldNumberMock.isNullable,
    defaultValue: fieldNumberMock.defaultValue,
    isLabelSyncedWithName: true,
    createdAt: new Date(),
    updatedAt: new Date(),
  };

  const fieldsById: FieldMetadataMap = {
    'field-number-id': completeFieldNumberMock,
  };

  const mockObjectMetadataWithFieldMaps = {
    ...objectMetadataItemMock,
    fieldsById,
    fieldIdByName: {
      [completeFieldNumberMock.name]: completeFieldNumberMock.id,
    },
    fieldIdByJoinColumnName: {},
    indexMetadatas: [],
  };

  describe('Should handle relation', () => {
    it.only('valid join column id', () => {
      expect(() =>
        checkFields(OPPORTUNITY_MOCK, ['pointOfContactId']),
      ).not.toThrow();
    });

    it.only('invalid as not join column id', () => {
      expect(() =>
        checkFields(OPPORTUNITY_MOCK, ['pointOfContact']),
      ).not.toThrow();
    });
  });

  it('should check field types', () => {
    expect(() =>
      checkFields(mockObjectMetadataWithFieldMaps, ['fieldNumber']),
    ).not.toThrow();

    expect(() =>
      checkFields(mockObjectMetadataWithFieldMaps, ['wrongField']),
    ).toThrow();

    expect(() =>
      checkFields(mockObjectMetadataWithFieldMaps, [
        'fieldNumber',
        'wrongField',
      ]),
    ).toThrow();
  });
});
